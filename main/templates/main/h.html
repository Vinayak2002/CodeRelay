{% extends 'main/base.html' %} 
{% block title %}Home Page{% endblock %} 
{% block style %}
<style>
  .mt-2 {
    margin-left: 30px;
    margin-right: 30px;
  }
  .navbar-nav > li > a {
    font-size: 15px;
    white-space: nowrap; 
    margin-top: auto;
    margin-bottom: 20px;
  }
  .filter {
    display: flex;
    flex-wrap: nowrap;
    flex-direction: row;
    justify-content:space-evenly;
  }

  .filter > form > button {
    margin: 20px;
    background: rgb(56, 225, 56);
  }

  .text {
    margin-top: 30px;
  }

  .btn {
    color:black;
  }
</style>
{% endblock %} 

{% block content %} 
  <div class="filter">
    {% if perms.main.change_complaint %}
      <p class="text">Filter By - </p>
      <form method="post">
        {% csrf_token %}
        <button
          type="submit"
          class="btn"
          name="filter-id"
          value="{{ 'hostel_name' }}"
        >
          Hostel
        </button>

        <button
          type="submit"
          class="btn"
          name="filter-id"
          value="{{ 'category' }}"
        >
          Issue Category
        </button>

        <button
          type="submit"
          class="btn"
          name="filter-id"
          value="{{ 'availability' }}"
        >
          Student Availability
        </button>

        <button
          type="submit"
          class="btn"
          name="filter-id"
          value="{{ 'created_at' }}"
        >
          Date Issued
        </button>
      </form>
    {% endif %}
  </div>
{% for complaint in complaints %}
{% if user == complaint.person %}
  <div class="card mt-2">
    <div class="card-header"><strong>User: {{ complaint.person.username }}</strong></div>
    <div class="card-header"><strong>Room: {{ complaint.room }}</strong></div>
    <div class="card-header"><strong>Hostel: {{ complaint.hostel_name }}</strong></div>
    <div class="card-body d-flex flex-row justify-content-between">
      <div>
        <h5 class="card-title">{{post.title}}</h5>
        <p>{{complaint.description}}</p>
      </div>
      <div>
        {% if user == complaint.person %}
          <form method="post">
          {% csrf_token %}
            <button
              type=""
              class="btn btn-primary"
            >
              {{ complaint.status }}
            </button>

            <button
              type="submit"
              class="btn btn-danger"
              name="complaint-id-delete"
              value="{{complaint.id}}"
            >
              Delete
            </button>
          </form>
        {% endif %}

        {% if perms.main.change_complaint %}
        <form method="post">
          {% csrf_token %}
          <button
            type="submit"
            class="btn btn-success"
            name="complaint-id-accept"
            value="{{complaint.id}}"
          >
            Accept
          </button>
          {% if user.username == "officer_1" or user.username == "officer_2" %}
          <button
            type="submit"
            class="btn btn-warning"
            name="complaint-id-escalate"
            value="{{complaint.id}}"
          >
            Escalate
          </button>
          {% endif %}
          <button
            type="submit"
            class="btn btn-danger"
            name="complaint-id-reject"
            value="{{complaint.id}}"
          >
            Reject
          </button>
        </form>
        {% endif %}

      </div>
    </div>
    <div class="card-footer text-muted">Availability: {{complaint.availability}}</div>
    <div class="card-footer text-muted">Createad At: {{complaint.created_at}}</div>
  </div>
{% endif %}

{% if perms.main.change_complaint %}
  <div class="card mt-2">
    <div class="card-header"><strong>User: {{ complaint.person.username }}</strong></div>
    <div class="card-header"><strong>Room: {{ complaint.room }}</strong></div>
    <div class="card-header"><strong>Hostel: {{ complaint.hostel_name }}</strong></div>
    <div class="card-body d-flex flex-row justify-content-between">
      <div>
        <h5 class="card-title">{{post.title}}</h5>
        <p>{{complaint.description}}</p>
      </div>
      <div>
        {% if user == complaint.person %}
          <form method="post">
          {% csrf_token %}
            <button
              type=""
              class="btn btn-primary"
            >
              {{ complaint.status }}
            </button>

            <button
              type="submit"
              class="btn btn-danger"
              name="complaint-id-delete"
              value="{{complaint.id}}"
            >
              Delete
            </button>
          </form>
        {% endif %}

        {% if perms.main.change_complaint %}
        <form method="post">
          {% csrf_token %}
          <button
            type="submit"
            class="btn btn-success"
            name="complaint-id-accept"
            value="{{complaint.id}}"
          >
            Accept
          </button>
          {% if user.username == "officer_1" or user.username == "officer_2" %}
          <button
            type="submit"
            class="btn btn-warning"
            name="complaint-id-escalate"
            value="{{complaint.id}}"
          >
            Escalate
          </button>
          {% endif %}
          <button
            type="submit"
            class="btn btn-danger"
            name="complaint-id-reject"
            value="{{complaint.id}}"
          >
            Reject
          </button>
        </form>
        {% endif %}

      </div>
    </div>
    <div class="card-footer text-muted">Availability: {{complaint.availability}}</div>
    <div class="card-footer text-muted">Createad At: {{complaint.created_at}}</div>
  </div>
{% endif %}


{% empty %}
<p>No complaints pending...</p>
{% endfor %} 
{% endblock %}
